-- To find bodypart 'spirits (body part)' in male person authors:
select gengen.name as 'gender of author (persons)', COUNT(*), SUBSTRING(sent_date_year, 0, 4) || "0s" as "decades" 
from researchdata_letter l 
left join researchdata_letterperson lp on l.id = lp.letter_id 
left join researchdata_person p on lp.person_id = p.id 
left join researchdata_slgeneric gengen on p.gender_id = gengen.id  
left JOIN researchdata_letterperson_body_part lpbp on lp.id = lpbp.letterperson_id   
LEFT JOIN researchdata_slgeneric genbp ON lpbp.slletterpersonbodypart_id = genbp.id
where lp.person_letter_relationship_id = 278
and lp.person_id is not null
and p.gender_id is 1
and genbp.name is 'spirits (body part)'
group by "decades", "gender of author (persons)"; 

-- To find bodypart 'spirits (body part) in author other person:
select genothergen.name as 'gender of author (personsother)', COUNT(*), SUBSTRING(sent_date_year, 0, 4) || "0s" as "decades"
from researchdata_letter l
left join researchdata_letterperson lp on l.id = lp.letter_id  
left join researchdata_slgeneric genothergen on lp.person_other_gender_id = genothergen.id 
left JOIN researchdata_letterperson_body_part lpbp on lp.id = lpbp.letterperson_id   
LEFT JOIN researchdata_slgeneric genbp ON lpbp.slletterpersonbodypart_id = genbp.id
and lp.person_letter_relationship_id is 278
where lp.person_other_gender_id is not null
and genbp.name is 'hands'
group by "decades", 'gender of author (personsother)'; 

-- To find BODY PART as discussed by gender of LPs when authors:
select genbp.name as 'body part',  
   gengen.name as "gender", 
   count(*) as count,  
   ( 
    select count (*) 
from researchdata_letterperson_body_part lpbp 
LEFT JOIN researchdata_letterperson lp2 ON lpbp.letterperson_id = lp2.id 
LEFT JOIN researchdata_person p2 ON lp2.person_id = p2.id 
where p.gender_id = p2.gender_id 
   ) as total_gender, 
   round(((count(*) * 1.0)/( 
    select count (*) 
from researchdata_letterperson_body_part lpbp 
LEFT JOIN researchdata_letterperson lp2 ON lpbp.letterperson_id = lp2.id 
LEFT JOIN researchdata_person p2 ON lp2.person_id = p2.id 
where p.gender_id = p2.gender_id 
   ))*100, 2) || '%' as '% count of total_gender' 
from researchdata_letterperson_body_part lpbp 
LEFT JOIN researchdata_letterperson lp ON lpbp.letterperson_id = lp.id 
LEFT JOIN researchdata_person p ON lp.person_id = p.id 
left join researchdata_slgeneric genbp on lpbp.slletterpersonbodypart_id = genbp.id 
left join researchdata_slgeneric gengen on p.gender_id = gengen.id 
where lp.person_other_gender_id is null and p.gender_id is not null and lp.person_letter_relationship_id is 278
group by slletterpersonbodypart_id, p.gender_id; 
